Скрипт для сжатия больших таблиц в Postgresql
+ функция  shrink_large_tables (дата,размер,тест)
где:
    дата - граница для таблиц с полем timestamp до которой будут удалены записи
    размер - максимальный суммарный размер таблицы для очистки в байтах
    тест - признак использовать только вывод сообщений, вместо удаления, для просмотра будущих изменений

пример вызова 
    SELECT shrink_large_tables('2021-07-30 23:00:00', 20971520, true) 